<!doctype html public "-//w3c//dtd xhtml 1.0 strict//en" 
"http://www.w3.org/tr/xhtml1/dtd/xhtml1-strict.dtd">

<html>

<head>
   <meta name="vs_targetSchema" content="http://schemas.microsoft.com/intellisense/ie5" />
   <meta name="DMViewName" content="GPRS PSI 1-2-3" />
   <meta name="DMViewWidth" content="900" />
   <meta name="DMViewHeight" content="1300" />
   <title>GPRS PSI 1-2-3</title>
   <link rel="stylesheet" href="QXDMStyle.css" />
</head>

<body onunload="Unregister()" onload="Register()">

<table border="0" width="100%" cellpadding="2">
   <colgroup span="2">
      <col width="50%" />
      <col width="50%" />
   </colgroup>

   <tr>
   
      <td valign="top" class="noborder">
         <div class="label">GPRS PSI 1</div>
         <table width="100%" id="PSI1Table">
            <colgroup span="2">
               <col width="50%" />
               <col width="50%" />
            </colgroup>
            <tr>
               <th>PBCCH Change Mark</th>
               <td>-</td>
            </tr>
            <tr>
               <th>PSI Count LR</th>
               <td>-</td>
            </tr>
            <tr>
               <th>PSI Count HR</th>
               <td>-</td>
            </tr>
            <tr>
               <th>Measurement Order</th>
               <td>-</td>
            </tr>
            <tr>
               <th>Access Control Class</th>
               <td>-</td>
            </tr>
            <tr>
               <th>Max Re-TX Priority 1</th>
               <td>-</td>
            </tr>
            <tr>
               <th>Max Re-TX Priority 2</th>
               <td>-</td>
            </tr>
            <tr>
               <th>Max Re-TX Priority 3</th>
               <td>-</td>
            </tr>
            <tr>
               <th>Max Re-TX Priority 4</th>
               <td>-</td>
            </tr>
            <tr>
               <th>S Parameter</th>
               <td>-</td>
            </tr>
            <tr>
               <th>Number Of Slots</th>
               <td>-</td>
            </tr>
            <tr>
               <th>Persistence Level Priority 1</th>
               <td>-</td>
            </tr>
            <tr>
               <th>Persistence Level Priority 2</th>
               <td>-</td>
            </tr>
            <tr>
               <th>Persistence Level Priority 3</th>
               <td>-</td>
            </tr>
            <tr>
               <th>Persistence Level Priority 4</th>
               <td>-</td>
            </tr>
            <tr>
               <th>BS PCC Release Pending</th>
               <td>-</td>
            </tr>
            <tr>
               <th>BS PBCCH Blocks</th>
               <td>-</td>
            </tr>
            <tr>
               <th>BS PRACH Blocks</th>
               <td>-</td>
            </tr>
            <tr>
               <th>PCCCH - Blocks Allocated</th>
               <td>-</td>
            </tr>
            <tr>
               <th>PSI Status Indicator</th>
               <td>-</td>
            </tr>
            <tr>
               <th>SGSNR</th>
               <td>-</td>
            </tr>
            <tr>
               <th>MSCR</th>
               <td>-</td>
            </tr>
         </table>
      </td>
      
      <td valign="top" class="noborder">
         <div class="label">GPRS PSI 2</div>
         <table width="100%" id="PSI2Table">
            <colgroup span="2">
               <col width="50%" />
               <col width="50%" />
            </colgroup>
            <tr>
               <th>MCC</th>
               <td>-</td>
            </tr>
            <tr>
               <th>MNC</th>
               <td>-</td>
            </tr>
            <tr>
               <th>Location Area Specification</th>
               <td>-</td>
            </tr>
            <tr>
               <th>Routing Area Identification</th>
               <td>-</td>
            </tr>
            <tr>
               <th>Cell Identity</th>
               <td>-</td>
            </tr>
            <tr>
               <th>Non GPRS Cell Present</th>
               <td>-</td>
            </tr>
            <tr>
               <th>Attach/Detach Allowed</th>
               <td>-</td>
            </tr>
            <tr>
               <th>T3212</th>
               <td>-</td>
            </tr>
            <tr>
               <th>NECI</th>
               <td>-</td>
            </tr>
            <tr>
               <th>Power Control Indicator</th>
               <td>-</td>
            </tr>
            <tr>
               <th>DTX Indicator</th>
               <td>-</td>
            </tr>
            <tr>
               <th>Radio Link Timeout</th>
               <td>-</td>
            </tr>
            <tr>
               <th>BS AG Blocks Reserved</th>
               <td>-</td>
            </tr>
            <tr>
               <th>BS CC Channels</th>
               <td>-</td>
            </tr>
            <tr>
               <th>BS CCCH/SDCCH Combination</th>
               <td>-</td>
            </tr>
            <tr>
               <th>BS PA Multiframes</th>
               <td>-</td>
            </tr>
            <tr>
               <th>Maximum Retransmissions</th>
               <td>-</td>
            </tr>
            <tr>
               <th>Transmission Integer</th>
               <td>-</td>
            </tr>
            <tr>
               <th>Access Control</th>
               <td>-</td>
            </tr>
            <tr>
               <th>MS TX Power Max CCCH</th>
               <td>-</td>
            </tr>
         </table>
      </td>
   </tr>
   <tr>
      <td colspan="2" valign="top" class="noborder">
         <div class="label">GPRS PSI 3 Serving Cell</div>
         <table width="100%" id="PSI3ServTable">
            <colgroup span="2">
               <col width="50%" />
               <col width="50%" />
            </colgroup>
            <tr>
               <th>Exclusive Access</th>
               <td>-</td>
            </tr>
            <tr>
               <th>Cell Bar Access</th>
               <td>-</td>
            </tr>
            <tr>
               <th>Random Access</th>
               <td>-</td>
            </tr>
            <tr>
               <th>Multiband Report</th>
               <td>-</td>
            </tr>
         </table>
         
         </br>
                  
         <div class="label">GPRS PSI 3 Neighbor Cells</div>
         <table width="100%" id="PSI3NeighborTable">
            <colgroup span="9">
               <col width="11%" />
               <col width="11%" />
               <col width="11%" />
               <col width="12%" />
               <col width="11%" />
               <col width="11%" />
               <col width="11%" />
               <col width="11%" />
               <col width="11%" />
            </colgroup>
            <tr>
               <th>BCCH ARFCN</th>
               <th>PLMN Color</th>
               <th>BS Color</th>
               <th>Exclusive Access</th>
               <th>Cell Bar Access</th>
               <th>SI13 PBCCH</th>
               <th>PBCCH</th>
               <th>SI13</th>
               <th>PBCCH Location</th>
            </tr>
            <tr>
               <td>-</td>
               <td>-</td>
               <td>-</td>
               <td>-</td>
               <td>-</td>
               <td>-</td>
               <td>-</td>
               <td>-</td>
               <td>-</td>
            </tr>
         </table>
      </td>
      
   </tr>
</table>

<script type="text/jscript" src="HelperFunctions.js"></script>
<script type="text/jscript">

var IQXDM2;
var Handle             = 0xFFFFFFFF;
var gMainTickID        = 0;
var TIMEOUT_MS         = 500;
var UPDATE_MS          = 1000;
var PrevIndex          = -1;
var LOG_ON_DEMAND_REQ  = "Log On Demand Request";

function Register()
{
   IQXDM2 = window.external;
   if (IQXDM2 == null)
   {
      window.document.write( "<br />QXDM does not support required interface" );
      return;
   }

   // We start by registering as a client
   Handle = IQXDM2.RegisterClient( "", 0 );
   if (Handle == 0xFFFFFFFF)
   {
      window.document.write( "<br />Unable to register as client" );
   }
   
   // Get a configuration object
   var clientObject = IQXDM2.ConfigureClientByKeys( Handle );
   if (clientObject == null)
   {
      window.document.write("<br />Failed to get client interface pointer");
      return;
   }
         
   // Configure items
   clientObject.AddLog( 0x51FD );
   clientObject.AddLog( 0x51FE );
   clientObject.AddLog( 0x51FF );

   clientObject.CommitConfig();
   
   // Go ahead and ask GPRS System Packet Information Logs
   RequestGPRSSystemPackets();   
   
   // Setup the main update timer
   gMainTickID = setInterval( 'ProcessItems()', UPDATE_MS );
}

// Clean up on unloading the page
function Unregister()
{
   if (gMainTickID != 0)
   {
      window.clearInterval( gMainTickID );
      gMainTickID = 0;
   }

   if (Handle != 0xFFFFFFFF)
   {
      IQXDM2.UnregisterClient( Handle );
   }
}

// Request GPRS System Packet Information Logs
function RequestGPRSSystemPackets()
{  
   RequestLogOnDemand( 0x51FD );
   RequestLogOnDemand( 0x51FE );
   RequestLogOnDemand( 0x51FF );
}

// Request a log using the log on demand DIAG command
function RequestLogOnDemand( logCode )
{
   var ReqID = IQXDM2.RequestItem( LOG_ON_DEMAND_REQ,
                                   logCode,
                                   1,
                                   TIMEOUT_MS,
                                   1,
                                   1 );

   if (ReqID == null)
   {
      window.document.write( "<br /> Error scheduling request" );
      return;
   }
}

// Process our client - we only update each type of log based on 
// the last item since the user cannot discern anything faster than 
// our update interval
function ProcessItems()
{
   var Log51FD  = "[0x51FD]";
   var Log51FE  = "[0x51FE]";
   var Log51FF  = "[0x51FF]"; 
       
   var bLog51FD = false;
   var bLog51FE = false;
   var bLog51FF = false;
   
   // Go ahead and ask GPRS System Packet Information Logs
   RequestGPRSSystemPackets();    
   
   var CurrIndex = IQXDM2.GetClientItemCount( Handle ) - 1;
   if (PrevIndex > CurrIndex)
   {
      // Reset index if it is greater than item count
      PrevIndex = -1;
   }

   // Make sure there is an item
   if (CurrIndex < 0)
   {
      return;
   }  

   for (var i = CurrIndex; i > PrevIndex; i--)
   {   
      var Item = IQXDM2.GetClientItem( Handle, i );
      if (Item != null)
      {
         var Fields = Item.GetItemFields();
         if (Fields != null)
         {
            var ItemKey = Item.GetItemKeyText();
            switch (ItemKey)
            {
               case Log51FD:
               {
                  if (bLog51FD == false)
                  {
                     PopulateSimpleFieldTable( Fields, PSI1Table);
                     bLog51FD = true;
                  }
               }
               break;
               
               case Log51FE:
               {
                  if (bLog51FE == false)
                  {
                     PopulatePSI2Table( Fields );
                     bLog51FE = true;
                  }
               }
               break;
               
               case Log51FF:
               {
                  if (bLog51FF == false)
                  {
                     PopulatePSI3Table( Fields );
                     bLog51FF = true;
                  }
               }
               break;
            }
            
            if (bLog51FD == true && bLog51FE == true && bLog51FF == true)
            {
               // We processed the last instance of each log so exit early
               break;
            }
         }
      }
   }
}

function PopulatePSI2Table( Fields )
{
   var Digit;
   var FieldVal;
   var RowIndex = 4;
   var MCCString = "";
   var MNCString = "";
   var LAIString = "";
   var RAIString = "";
            
   for (var f = 0; f <= 2; f++)
   {
      Digit = FormatBCDDigit( Fields.GetFieldValue( f ) );
      MCCString += Digit;
   }
   PSI2Table.rows[0].cells[1].innerText = MCCString;
   
   for (var f = 3; f <= 5; f++)
   {
      Digit = FormatBCDDigit( Fields.GetFieldValue( f ) );
      MNCString += Digit;
   }
   PSI2Table.rows[1].cells[1].innerText = MNCString;
            
   for (var f = 6; f < 22; f++)
   {
      LAIString += Fields.GetFieldValueText( f );
   }
   PSI2Table.rows[2].cells[1].innerText = LAIString;
   
   for (var f = 22; f < 30; f++)
   {
      RAIString += Fields.GetFieldValueText( f );
   }
   PSI2Table.rows[3].cells[1].innerText = RAIString;
   
   for (var f = 30; f < 46; f++)
   {
      FieldVal = Fields.GetFieldValueText( f );
      PSI2Table.rows[RowIndex++].cells[1].innerText = FieldVal;
   }
}

function PopulatePSI3Table( Fields )
{   
   for (var f = 0; f < 4; f++)
   {
      PSI3ServTable.rows[f].cells[1].innerText = Fields.GetFieldValueText( f );
   }
 
   var DataIndex = 5;
   
   // Grab number of rows in existing table
   var CurRows = PSI3NeighborTable.rows.length;
   var NCellCount = Fields.GetFieldValue( 4 );
   ManageRows( PSI3NeighborTable, 1, CurRows, NCellCount, 9, true );  
   
   for (var f = 1; f <= NCellCount; f++)
   {
      for (var g = 0; g < 9; g++)
      {
         PSI3NeighborTable.rows[f].cells[g].innerText = Fields.GetFieldValueText( DataIndex++ );
      }
      
      DataIndex++;
   }
}

</script>
</body>
</html>